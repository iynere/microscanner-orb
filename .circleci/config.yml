# CircleCI build config to test the 
# Google Coud Platform Container Registry Orb published by CircleCI
#
version: 2.1

orbs:
  microscanner: ttrahan/microscanner@dev:alpha

jobs:
  test-orb-commands:
    executor: microscanner/default
    steps:
      # test orb commands
      - checkout
      - run: docker build -t myrepo/myimage:latest .
      - microscanner/install 
      - microscanner/scan:
          image: myrepo/myimage:latest

workflows:
  scan:
    jobs:
      # test orb commands
      - test-orb-commands:
          context: ttrahan

      # # test orb jobs
      # - gcp-gcr/build_and_push_image:
      #     context: ttrahan
      #     google-project-id: citric-biplane-94023
      #     google-compute-zone: us-west1-b
      #     registry-url: us.gcr.io
      #     image: sample-image
      #     tag: $CIRCLE_BRANCH.$CIRCLE_BUILD_NUM

      # # test orb jobs with default values only
      # - gcp-gcr/build_and_push_image:
      #     context: ttrahan
